// Prisma schema for OrderWorks job management

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum JobStatus {
  PENDING   @map("pending")
  PRINTING  @map("printing")
  COMPLETED @map("completed")
}

enum FulfillmentStatus {
  PENDING   @map("pending")
  READY     @map("ready")
  SHIPPED   @map("shipped")
  PICKED_UP @map("picked_up")
}

model Job {
  id               String     @id
  paymentIntentId  String     @unique
  totalCents       Int
  currency         String
  lineItems        Json
  shipping         Json?
  metadata         Json?
  userId           String?
  customerEmail    String?
  makerworksCreatedAt DateTime @map("makerworks_created_at")
  makerworksUpdatedAt DateTime @map("makerworks_updated_at")
  status           JobStatus  @default(PENDING)
  notes            String?
  paymentMethod    String?    @map("payment_method")
  paymentStatus    String?    @map("payment_status")
  invoiceSentAt    DateTime?  @map("invoice_sent_at")
  invoiceSendCount Int        @default(0) @map("invoice_send_count")
  fulfillmentStatus FulfillmentStatus @default(PENDING) @map("fulfillment_status")
  fulfilledAt      DateTime?  @map("fulfilled_at")
  queuePosition    Int        @default(0) @map("queue_position")
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  viewedAt         DateTime?  @map("viewed_at")

  @@map("jobs")
  @@index([status])
  @@index([makerworksCreatedAt])
  @@index([queuePosition])
}
