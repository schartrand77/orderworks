// Prisma schema for OrderWorks job management

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum JobStatus {
  PENDING   @map("pending")
  PRINTING  @map("printing")
  COMPLETED @map("completed")
}

model Job {
  id               String     @id
  paymentIntentId  String     @unique
  totalCents       Int
  currency         String
  lineItems        Json
  shipping         Json?
  metadata         Json?
  userId           String?
  customerEmail    String?
  makerworksCreatedAt DateTime @map("makerworks_created_at")
  status           JobStatus  @default(PENDING)
  invoiceUrl       String?
  notes            String?
  queuePosition    Int        @default(0) @map("queue_position")
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  @@map("jobs")
  @@index([status])
  @@index([makerworksCreatedAt])
  @@index([queuePosition])
}
